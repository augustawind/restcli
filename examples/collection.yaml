---
lib:
    - restcli.contrib.scripts

defaults:
    headers:
        Content-Type: application/json
        Accept: application/json
        Authorization: 'JWT {{ jwt_token }}'

---
action-types:
    list:
        method: get
        url: '{{ host }}/action_types'
        script: |
            set_env(200, 'action_type_name', [0, 'name'],
                    ignore_missing_index=True)
    get:
        method: get
        url: '{{ host }}/action_types/{{ action_type_name }}'
        script: |
            set_env(200, 'action_type_name', ['name'])
actions:
    list:
        method: get
        url: '{{ host }}/actions'
        script: |
            set_env(200, 'action_id', [0, 'id'],
                    ignore_missing_index=True)
    post:
        method: post
        url: '{{ host }}/actions'
        body: |
            name: POST Action
            type: {{ action_type_name }}
            device: {{ device_id }}
            space: {{ space_id }}
        script: |
            set_env(201, 'action_id', ['id'])
    opt-list:
        method: options
        url: '{{ host }}/actions'
    get:
        method: get
        url: '{{ host }}/actions/{{ action_id }}'
        script: |
            set_env(200, 'action_id', ['id'])
    opt-detail:
        method: options
        url: '{{ host }}/actions/{{ action_id }}'
auth:
    login:
        method: post
        url: '{{ host }}/auth/login'
        body: |
            username: '{{ username }}'
            password: '{{ password }}'
        script: |
            set_env(200, 'jwt_token', ['token'])
    refresh:
        method: post
        url: '{{ host }}/auth/refresh'
        body: |
            token: '{{ jwt_token }}'
    revoke:
        method: put
        url: '{{ host }}/auth/revoke'
        body: |
            token: '{{ jwt_token }}'
    verify:
        method: post
        url: '{{ host }}/auth/verify'
        body: |
            token: '{{ jwt_token }}'
buildings:
    list:
        method: get
        url: '{{ host }}/buildings'
        script: |
            set_env(200, 'building_id', [0, 'id'],
                    ignore_missing_index=True)
    post:
        method: post
        url: '{{ host }}/buildings'
        body: |
            name: POST Building
            customer: '{{ customer_id }}'
            meta:
                - name: serial_number
                  display_name: Serial Number
                  value: ABC123
                - name: temperature
                  display_name: Temperature
                  value: 1.23
            timezone: UTC
            location:
                postal_code: '12345'
                addr1: 007 Easy Street
                state: FL
                country: US
                city: Pleasantville
        script: |
            set_env(201, 'building_id', ['id'])
    opt-list:
        method: options
        url: '{{ host }}/buildings'
    get:
        method: get
        url: '{{ host }}/buildings/{{ building_id }}'
        script: |
            set_env(200, 'building_id', ['id'])
    put:
        method: put
        url: '{{ host }}/buildings/{{ building_id }}'
        body: |
            name: PUT Building
            customer: '{{ customer_id }}'
            timezone: UTC
            location:
                postal_code: '54321'
                addr1: 007 Easy Street
                state: FL
                country: US
                city: Pleasantville
    patch:
        method: patch
        url: '{{ host }}/buildings/{{ building_id }}'
        body: |
            name: PATCH Building
    delete:
        method: delete
        url: '{{ host }}/buildings/{{ building_id }}'
    opt-detail:
        method: options
        url: '{{ host }}/buildings/{{ building_id }}'

partners:
    list:
        method: get
        url: '{{ host }}/partners'
        script: |
            set_env(200, 'partner_id', [0, 'id'],
                    ignore_missing_index=True)
    post:
        method: post
        url: '{{ host }}/partners'
        body: |
            name: POST Partner
            description: A Partner that doesn't really exist.
            location:
                addr1: 123 Foo St.
                city: Jupiter
                state: Florida
                country: United States
                postal_code: 33713
        script: |
            set_env(201, 'partner_id', ['id'])
    opt-list:
        method: options
        url: '{{ host }}/partners'
    get:
        method: get
        url: '{{ host }}/partners/{{ partner_id }}'
        script: |
            set_env(200, 'partner_id', ['id'])
    put:
        method: put
        url: '{{ host }}/partners{{ partner_id }}'
        body: |
            name: PUT Partner
            description: A Partner that _really_ doesn't exist.
            location:
                addr1: 345 Bar Ave.
                city: Saint Petersburg
                state: Florida
                country: United States
                postal_code: 33701
    patch:
        method: patch
        url: '{{ host }}/partners{{ partner_id }}'
        body: |
            name: PATCH Partner
    del:
        method: delete
        url: '{{ host }}/partners{{ partner_id }}'
    opt-detail:
        method: options
        url: '{{ host }}/partners{{ partner_id }}'
